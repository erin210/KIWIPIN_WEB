<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <title>KIWIPIN</title>
    <!-- <script src="config.js"></script> -->
    <!-- <script>
        (function () {
            var base = document.createElement('base');
            base.href = window.pageBaseUrl;
            document.head.appendChild(base);
        })();
    </script> -->
    <base href="https://stage-www-page.kiwipin.com">
    <script src="./assets/js/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="./assets/css/reset.css">
    <link rel="stylesheet" href="./assets/css/bootstrap-grid.css">
    <!-- <link rel="stylesheet" href="./assets/css/jquery.sidr.dark.min.css"> -->
    <link rel="stylesheet" href="./assets/css/select2.min.css" />
    <link rel="stylesheet" href="./assets/css/www.css?v=241008">
    <script src="./assets/js/lenis.min.js"></script>
    <script src='./assets/js/jquery-3.6.0.min.js'></script>
    <script src="./assets/js/jquery.sidr.min.js"></script>
    <script src="./assets/js/wow.min.js"></script>
    <script>
        function initFunction(jsonObj) {
            renderInfo(jsonObj);
        }
    </script>
</head>

<body>
    <header>
    </header>
    <main class="pages">
        <section class="areaPage page_result">
            <div class="wrap">
                <div class="resultBox">
                    <div class="result_message">
                        <img id="Notify_Icon" src="" alt="">
                        <span id="Notify_Title">恭喜您！點卡購買成功</span>
                    </div>
                    <div class="result_info"></div>
                    <a href="point_add.html" class="btn_start">
                        <span>繼續購買</span><i><img src="./assets/img/i_btn_arrow.svg" alt=""></i>
                    </a>
                </div>
            </div>

        </section>

    </main>
    <footer></footer>

    <!-- <script src="./assets/js/wow.min.js"></script> -->
    <script src="./assets/js/main.js"></script>
    <script>
        // $(function () {
        //     $('base').attr('href', apiUrl);
        // });

        $("header").load("./layout/header.html");
        $("footer").load("./layout/footer.html");

        // new WOW().init();
        // $(window).on('scroll', function () {
        //     handleFooterEffect();
        // });

        function renderInfo(json) {

            const dataSUCCESS = {
                "儲值密碼": json.PINCODE,
                "商品名稱": json.PRODUCT_NAME,
                "點卡序號": json.PIN_SERIAL,
                "點卡啟用日": json.START_TIME,
                "點卡到期日": json.EXPIRY_TIME,
                "訂單狀態": json.RMSG_CHI
            }
            const dataERROR = {
                "訂單狀態": json.RMSG_CHI,
                "商品名稱": json.PRODUCT_NAME
            }


            if (json.PAY_STATUS == "S") {
                $('#Notify_Icon').attr("src", "./assets/img/icon_success.svg");
                $("#Notify_Title").text("恭喜您！點卡購買成功");
                resultINFO(dataSUCCESS);
                $('.result_info').addClass('success_info');
                $('.result_info .item:first-child').find('.content').append('<span class="code_copy"><img  src="./assets/img/icon_copy.svg" alt="copy"/></span>');
                $('.result_info').removeAttr('id', "ERROR_INFO");
                $('.btn_start span').text('繼續購買');

            } else {
                $('#Notify_Icon').attr("src", "./assets/img/icon_error.svg");
                $("#Notify_Title").text("交易失敗").css({ 'color': 'var(--error)' });
                resultINFO(dataERROR);
                $('.result_info').addClass('error_info');
                $('.btn_start span').text('重新購買');
            }

            Object.keys(json).forEach(function (k) {
                var eleName = '#' + k;
                // console.log(eleName + ' - ' + json[k]);
                if ($(eleName).length <= 0) {
                    appendElement_Input('#form', k, json[k]);
                } else {
                    $(eleName).val(json[k]);
                }
            });

        }


        //印資料
        function resultINFO(data) {
            $(".result_info").empty();

            Object.entries(data).forEach(([key, value]) => {
                const TimeTXT = formatTime(value);
                const htmlINFO = `
                <div class="item">
                <div class="title">${key}</div>
                <div class="content">${(key == "點卡啟用日" || key == "點卡到期日") ? TimeTXT : value}</div>
                </div>`;

                $(".result_info").append(htmlINFO);

            });
        }

        function appendElement_Input(ele, name, value) {
            var textHtml = '<input type="hidden" name="' + name + '"';
            textHtml += ' value="' + value + '"';
            textHtml += '/>';
            $(ele).append(textHtml);
        }

        function check_submit() {
            document.getElementById('form').submit();

            //return true;
        }
        //時間標註
        function formatTime(tt) {
            const dateTime = tt;
            const [datePart, timePart] = dateTime.split(" ");
            const formattedDateTime = `${datePart} <b class="timetxt">${timePart}</b>`;
            return formattedDateTime;
        }
        //code_cpoy
        $('.result_info').on('click', '.code_copy', async function () {
            var contentText = $('.result_info .item:first-child').find('.content');
            var originalText = contentText.text(); //儲值密碼

            try {
                // 複製
                await navigator.clipboard.writeText(originalText);
                contentText.text('複製成功！');

                //恢復
                setTimeout(function () {
                    contentText.html(originalText + '<span class="code_copy"><img src="./assets/img/icon_copy.svg" alt="copy"/></span>');
                }, 1000);
            } catch (error) {
                console.error("複製失敗：", error);
            }
        });

    </script>
    <script>

        // initFunction({ "Tpye": "RETURN", "data": "eyJNU0dfVFlQRSI6IjAxMTAiLCJQQ09ERSI6IjMwMDAwMCIsIkNJRCI6IkMwMDAwMTAwMDAwMTMiLCJDT0lEIjoiS00yMDI1MDExMDAzMzQzMSIsIlJSTiI6IkdQMjUwMTEwMjAwMjY3MTIiLCJDVUlEIjoiVVNEIiwiUEFJRCI6IkJOS1JCUzAxIiwiQU1PVU5UIjoiMSIsIk9SREVSX1RZUEUiOiJNIiwiUEFZX1NUQVRVUyI6IlMiLCJSQ09ERSI6IjAwMDAiLCJQQVlfUkNPREUiOiIwMDAwIiwiTUlEIjoiTTEwMDAwMDEiLCJCSUQiOiIiLCJNRU1PIjoiIiwiTVdfVVJMIjoiIiwiTEFOR1VBR0UiOiIiLCJHQU1FX05BTUUiOiIiLCJQQUlEX05BTUUiOiIiLCJQUk9EVUNUX05BTUUiOiJLSVdJIFx1OWVkZVx1NTM2MSAxMDAgXHU5ZWRlIiwiUFJPRFVDVF9JRCI6IiIsIkJPTlVTX0lEIjoiIiwiVVNFUl9BQ0NUSUQiOiJ5b3Vyd2ViMjEwQGdtYWlsLmNvbSIsIlVTRVJfR1JPVVBJRCI6IiIsIlVTRVJfSVAiOiIxMTQuMzIuMTkuMjUyIiwiVFhUSU1FIjoiMjAyNTAxMTAxMTM0MzQiLCJFWFRFTlNJT04iOiIiLCJQOTlfSU5GTyI6IiIsIlBST01PX0NPREUiOiIiLCJSTVNHIjoiIiwiUk1TR19DSEkiOiJcdThhMGFcdTYwNmZcdTg2NTVcdTc0MDZcdTYyMTBcdTUyOWYiLCJQSFNfQ0hBTk5FTF9JRCI6IiIsIlBIU19DT01QQU5ZX0lEIjoiIiwiRVJQQyI6Imp0ZTZZY1FCZEJyZnRjRHQ4eUs0Sml5Q1hqbz0ifQ==", "PAY_STATUS": "S", "PRODUCT_NAME": "KIWI \u9ede\u5361 100 \u9ede", "PIN_SERIAL": "1000004513", "PINCODE": "XC8RDP1R7EPDE1FD", "START_TIME": "2025-01-10 11:36:11", "EXPIRY_TIME": "2027-01-10 11:36:11", "RMSG_CHI": "\u8a0a\u606f\u8655\u7406\u6210\u529f" });

        // initFunction({ "Tpye": "RETURN", "data": "eyJNU0dfVFlQRSI6IjAxMTAiLCJQQ09ERSI6IjMwMDAwMCIsIkNJRCI6IkMwMDAwMTAwMDAwMTMiLCJDT0lEIjoiS00yMDI1MDExMDAzMzA0OCIsIlJSTiI6IkdQMjUwMTEwMjAwMjY1NzAiLCJDVUlEIjoiVVNEIiwiUEFJRCI6IkJOS1JCUzAxIiwiQU1PVU5UIjoiMSIsIk9SREVSX1RZUEUiOiJNIiwiUEFZX1NUQVRVUyI6IkYiLCJSQ09ERSI6IjMwMDEiLCJQQVlfUkNPREUiOiIzMDAxIiwiTUlEIjoiTTEwMDAwMDEiLCJCSUQiOiIiLCJNRU1PIjoiIiwiTVdfVVJMIjoiIiwiTEFOR1VBR0UiOiIiLCJHQU1FX05BTUUiOiIiLCJQQUlEX05BTUUiOiIiLCJQUk9EVUNUX05BTUUiOiJLSVdJIFx1OWVkZVx1NTM2MSAxMDAgXHU5ZWRlIiwiUFJPRFVDVF9JRCI6IiIsIkJPTlVTX0lEIjoiIiwiVVNFUl9BQ0NUSUQiOiJ5b3Vyd2ViMjEwQGdtYWlsLmNvbSIsIlVTRVJfR1JPVVBJRCI6IiIsIlVTRVJfSVAiOiIxMTQuMzIuMTkuMjUyIiwiVFhUSU1FIjoiMjAyNTAxMTAxMTMwNTAiLCJFWFRFTlNJT04iOiIiLCJQOTlfSU5GTyI6IiIsIlBST01PX0NPREUiOiIiLCJSTVNHIjoiIiwiUk1TR19DSEkiOiJcdTcxMjFcdTZjZDVcdTViOGNcdTYyMTBcdTRlZDhcdTZiM2UiLCJQSFNfQ0hBTk5FTF9JRCI6IiIsIlBIU19DT01QQU5ZX0lEIjoiIiwiRVJQQyI6IklhZENUT2hRUE5uNE5QK2Nrc2VjSGtlOEFmZz0ifQ==", "PAY_STATUS": "F", "PRODUCT_NAME": "KIWI \u9ede\u5361 100 \u9ede", "PIN_SERIAL": "", "PINCODE": "", "START_TIME": "", "EXPIRY_TIME": "", "RMSG_CHI": "\u7121\u6cd5\u5b8c\u6210\u4ed8\u6b3e" });

    </script>
</body>

</html>